---
title: Redis 常用命令及类型
date: 2020-04-13 10:47:12
categories:
  - Redis
tags:
  - Redis
---

## 前言

听说过二八定律的应该知道，我们百分之二十的东西是支撑着百分之八十的运作的。所以我们了解和学习一个东西一开始不需要事无巨细的每个都精通，可以优先了解 20%常用的，然后再去根据具体的需要了解剩下的 80%。毕竟时间有限，那么多业务要写。

<!-- more -->

## 常用的 Redis 命令

| 命令                | 描述                                                         |
| ------------------- | ------------------------------------------------------------ |
| `keys *`            | 返回满足的所有键，可以模糊匹配，比如 keys abc\* 代表 abc 开头的 key |
| `type key`          | 查看 key 对应的数据类型                                      |
| `exists key`        | 是否存在指定的 key，存在返回 1，不存在返回 0                 |
| `expire key second` | 设置某个 key 的过期时间 时间为秒                             |
| `del key`           | 删除某个 key                                                 |
| `ttl key`           | 查看剩余时间，当 key 不存在时返回-2；存在但没有设置剩余生存时间时返回-1，返回 key 的剩余生存时间 |
| `persist key`       | 取消过期时间                                                 |
| `pexpire key ms`    | 修改 key 的过期时间为毫秒                                    |
| `select`            | 选择数据库 0-15，默认为 16 个数据库                          |
| `move key dbindex`  | 将当前数据中的 key 转移到其他数据库                          |
| `randomkey`         | 随机返回一个 key                                             |
| `rename key key1`   | 重命名 key                                                   |
| `echo`              | 打印命令                                                     |
| `dbsize`            | 查看数据库 key 数量                                          |
| `info`              | 查看数据库信息                                               |
| `config get *`      | 实时传储收到的请求，返回相关的配置                           |
| `flushdb`           | 清空当前数据库                                               |
| `flushall`          | 清空所有数据库                                               |



## expire 使用场景

- 限时的优惠活动信息
- 网站数据缓存（对于一些需要定时更新的数据，例如积分排行榜）
- 手机验证码
- 限制网站访客访问频率（例如：一秒钟最多 10 次）



## key的命名建议

redis单个key允许存入512M大小

- key不要太长，尽量不要超过1024字节，消耗内存会降低查找的效率
- key也不要太短，太短的话，key的可读性降低
- 在一个项目中，key最好使用同一的命名规范，例如：`user:id:name`
- key名称不区分大小写



## Redis数据类型

### String类型

string类型是Redis最基本的数据类型，一个键最大能存储512mb

string数据结构是简单的key-value类型，value其不仅是string，也可以是数字，是包含很多类型的特殊类型。

string类型是二进制安全的。意思是redis的string可以包含任何数据。比如序列化的对象进行存储，比如一张图片进行二进制存储，比如一个简单的字符串，数值等等。

#### String命令

```shell
赋值语法：
# Redis SET命令用于设置给定 key 的值，如果key已经存储值，set会复写旧值，且无视类型
SET KEY_NAME VALUE 

# 如果key不存在，则设值并返回1；如果key存在，则不设值并返回0
# 解决分布式锁 方案一，只有在key不存在时设置 key 的值，setnx(set if not exists)命令
# 指定的key不存在时，才会为key设置指定的值
SETNX key value

# expired 设置key的值为1x，过期时间为10秒，十秒后键值被清理
SETNX key 10 1x

# 给指定的 key 对应的值追加 value 至末尾，如果不存在，为其赋值
APPEND key_name value


取值语法：
# Redis GET命令用于获取指定 key 的值
# 如果key不存在，返回nil
# 如果key储存的值不是字符串类型，返回一个错误
GET key_name

# 用于获取存储在指定 key 中字符串的子字符串，字符串的截取范围由 start 和 end 两个偏移量决定
GETRANGE key start end

# 对key所储存的字符串值，获取指定偏移量上的位(bit)
GETBIT key offset

# Getset 命令用于设置指定 key 的值，并返回 key 的旧值，当key不存在时，返回nil
# 先取值后赋值操作（先取出旧的值，再修改新的值），当key不存在返回nil
GETSET key_name value

# 返回 key 所存储字符串的长度
STRLEN key


批量语法：
# 批量写，一次性写入多个值
MSET key1 value1 key2 value2...

# 批量读，一次性读取多个值
MGET key1 key2 key3...


删值语法：
# 删除指定的key，如果存在，返回值数字类型。
DEL key_name


自增/自减（value必须是数字类型哟，否则报错）：
# INCR 命令将 key 中存储的数字值增1。如果key不存在，那么key的值会先初始化位0，
# 然后再执行 INCR 操作
INCR key_name

# 给指定的 key 加上指定大小的增量
INCRBY key_name 增量值

# DECR 命令将 key 中存储的数字值减1。如果key不存在，那么key的值会先初始化位0，
# 然后再执行 DECR 操作
DECR key_name

# 给指定的 key 减去指定大小的减值
DECRBY key_name
```

#### 应用场景

- string通常用于保存单个字符串或JSON字符串数据
- string是二进制安全的，可以把一个图片文件作为字符串储存
- 计数器（常规key-value缓存应用，常规技术：粉丝数，文章浏览量）



### Hash类型

Hash类型是String类型的field和value的映射表，或者说是string的集合。Hash特别适合存储对象，相比较而言，将一个对象类型存储在Hash类型要存储在String类型里占用更少的内存空间，并对整个对象存取。

可以看成具有key和value的map容器，该类型非常适合存储键值对象的信息。

如：uname,upass,age等。该类型的数据仅占用很少的磁盘空间（相比于json）

Redis中每个Hash可以存储`2^32 - 1`键值对（40多亿）



#### 常用命令

```shell
赋值语句：
# 指定的key，设定 field value
HSET key field value

# 同时将多个field-value(域-值)对设置到哈希表 key 中
HMSET key field value [field1 value1]...


取值语句：
# 获取存储在Hash中的值，根据field 获取 value
HGET key field

# 获取 key 所有给定字段的 value
HMGET key field [field1]

# 返回Hash表中所有的字段和值
HGETALL key

# 获取所有哈希表中的字段
HKEYS key

# 获取哈希表中字段的数量
HLEN key


删除语法：
# 删除一个或多个hash表字段
HDEL key field [field2]


其它语法：
# 只有在字段 field 不存在时，设置哈希表字段的值
HSETNX key field value

# 为哈希表 key 中的指定字段的整数值加上增量 increment
HINCRBY key field increment

# 为哈希表 key 中的指定字段的浮点数值加上增量 increment
HINCRBYFLOAT key field increment

# 查看哈希表 key 中，指定的字段是否存在
HEXISTS key field
```

#### 应用场景

Hash的应用场景：（存储一个用户信息对象数据）

- 常用于存储一个对象

> Hash时最接近数据库结构的数据类型，可以将数据库一条记录或程序中一个对象转换成hashmap存放在redis中。
>
> 用户ID为查找的key，存储的value用户对象包含姓名、年龄、生日等信息，如果用普通的key/value结构来存储，主要以下两种存储方式：
>
> 1. 将用户id作为查找key，把其他信息封装成一个对象以序列的方式存储，这种方式缺点是，增加了序列化/反序列化的开销，并且需要修改其中一项信息时，需要把整个对象取回，并修改操作需要对并发进行保护，引入CAS等复杂问题
> 2. 这个用户信息对象由多少成员就存储多少个key-value对，用户id+对应的名称作为唯一标识来取得对应属性的值，虽然省去序列化开销和并发问题，但是用户ID为重复存储，如果存在大量这样的数据，内存浪费还是非常可观的。



### List 类型

List类型是一个链表结构的集合，其主要功能有push、pop、获取元素等。更详细的说，List类型是一个双端链表的节后，我们可以通过相关操作进行集合的头部或者尾部添加和删除元素，List的设计非常简单精巧，及可以作为栈，也可以作为队列，满足绝大多数的需求。

>按照插入顺序排序，你可以添加一个元素到列表头部或者尾部，一个列表最多可以包含 2^32-1 个元素（40忆个元素）类似Java中的LinkedList



#### 常用命令

```shell
赋值语法：

```

